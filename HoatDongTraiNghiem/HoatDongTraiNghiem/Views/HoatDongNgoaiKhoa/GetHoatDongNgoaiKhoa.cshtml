
@{
    ViewBag.Title = "Danh sách hoạt dộng ngoại khóa";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h3 class="text-center text-primary">DANH SÁCH HOẠT ĐỘNG NGOẠI KHÓA</h3>

@{
    if (ViewBag.Registrations.Count > 0)
    {
        <p><button class="btn btn-primary" onclick="downloadExcel();"><span class="glyphicon glyphicon-download-alt"></span>  XUẤT EXCEL</button></p>
    }
    else
    {
        <p><button class="btn btn-primary disabled" onclick="downloadExcel();"><span class="glyphicon glyphicon-download-alt"></span>  XUẤT EXCEL</button></p>
    }
}

<div class="panel panel-default">
    <div class="panel-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Lớp</th>
                        <th>Số lượng</th>
                        <th>Ngày tham gia</th>
                        <th>Địa điểm</th>
                        <th>Tên người phụ trách</th>
                        <th>Số điện thoại</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        int index = 1;
                        foreach (var item in ViewBag.Registrations)
                        {
                            <tr>
                                <td>@index</td>
                                <td>@item.ClassId</td>
                                <td>@item.StudentQuantity</td>
                                <td>@item.DateRegisted.ToString("dd/MM/yyyy")</td>
                                <td>@item.Province.Type @item.Province.Name</td>
                                <td>@item.Creator</td>
                                <td>@item.PhoneNumber</td>
                                <td><button type="button" value="@item.Id" onclick="viewDetail(this);" class="btn btn-success btn-sm" data-toggle="modal" data-target=".bs-example-modal-sm">CHI TIẾT</button></td>
                            </tr>
                            index++;
                        }

                    }

                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="modal">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Chi tiết
                </div>
                <div class="panel-body">
                    <form class="form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Tên trường</label>
                            <div class="col-sm-9">
                                <p class="form-control-static" id="schoolName"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Lớp</label>
                            <div class="col-sm-9">
                                <p class="form-control-static" id="class"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Số lượng</label>
                            <div class="col-sm-9">
                                <p class="form-control-static" id="studentQuantity"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Ngày tham gia</label>
                            <div class="col-sm-9">
                                <p class="form-control-static" id="dateGo"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Nội dung thực hiện hoạt động</label>
                            <div class="col-sm-9">
                                <p class="form-control-static" id="activityName"></p>
                            </div>
                        </div>
                       
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Tóm tắt nội dung</label>
                            <div class="col-sm-9">
                                <p class="form-control-static" id="tomtatnoidung"></p>
                            </div>
                        </div>
                       
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Địa điểm</label>
                            <div class="col-sm-9">
                                <p class="form-control-static" id="location"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">File bảo hiểm chuyến đi</label>
                            <div class="col-sm-9">
                                <p class="form-control-static"><a onclick="downloadPDF(this);" id="FileBaoHiemChuyenDi"></a></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">File danh sách phân xe</label>
                            <div class="col-sm-9">
                                <p class="form-control-static"><a onclick="downloadPDF(this);" id="FileDanhSachPhanXeVaGV"></a></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">File Hợp đồng kí kết phối hợp</label>
                            <div class="col-sm-9">
                                <p class="form-control-static"><a onclick="downloadPDF(this);" id="FileHDKKPhoiHopToChuc"></a></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">File kế hoạch tổ chức</label>
                            <div class="col-sm-9">
                                <p class="form-control-static"><a onclick="downloadPDF(this);" id="FileKeHoachToChuc"></a></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">File lịch trình hoạt động</label>
                            <div class="col-sm-9">
                                <p class="form-control-static"><a onclick="downloadPDF(this);" id="FileLichTrinhHoatDong"></a></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">File nội quy chuyến đi</label>
                            <div class="col-sm-9">
                                <p class="form-control-static"><a onclick="downloadPDF(this);" id="FileNoiQuyChuyenDi"></a></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">File phương án chi tiết an toàn</label>
                            <div class="col-sm-9">
                                <p class="form-control-static"><a onclick="downloadPDF(this);" id="FilePhuongAnChiTietAnToan"></a></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">File QĐ thành lập ban tổ chức</label>
                            <div class="col-sm-9">
                                <p class="form-control-static"><a onclick="downloadPDF(this);" id="FileQDThanhLapBanToChuc"></a></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">File Thư báo cho cha mẹ</label>
                            <div class="col-sm-9">
                                <p class="form-control-static"><a onclick="downloadPDF(this);" id="FileThuBaoChoChaMe"></a></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Tên người phụ trách</label>
                            <div class="col-sm-9">
                                <p class="form-control-static" id="teacherName"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Chức vụ</label>
                            <div class="col-sm-9">
                                <p class="form-control-static" id="jobTitle"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Số điện thoại</label>
                            <div class="col-sm-9">
                                <p class="form-control-static" id="phoneNumber"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Email</label>
                            <div class="col-sm-9">
                                <p class="form-control-static" id="email"></p>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-sm-6 col-xs-6">
                            <p class="text-left">
                                <span class="text-left"><button class="btn btn-danger">XÓA</button></span>
                            </p>
                        </div>
                        <div class="col-sm-6 col-xs-6">
                            <p class="text-right">
                                <span class="text-right"><button type="button" class="btn btn-primary" onclick="closeModal();">ĐÓNG</button></span>
                            </p>

                        </div>
                    </div>


                </div>
            </div>

        </div>
    </div>
</div>

<script>
    $('.datepicker').datepicker(
        {
            format: 'dd-mm-yyyy',
            autoclose: true,
        }
    );
    function viewDetail(data) {
        $.get('/hoatdongngoaikhoa/chitiet/' + data.value, function (data, status) {
            var registration = JSON.parse(data.Results);
            console.log(registration);
            $('#schoolName').text(registration.SchoolName);
            $('#class').text(registration.ClassId);
            $('#studentQuantity').text(registration.StudentQuantity);
            $('#dateGo').text(moment(registration.DateRegisted, 'YYYY/MM/DD').format('DD/MM/YYYY'));
            $('#activityName').text(registration.ActivityName);
            
            $('#tomtatnoidung').text(registration.Summary);
            $('#location').text(registration.Province.Type + ' ' + registration.Province.Name);
            $('#FileBaoHiemChuyenDi').text(registration.FileBaoHiemChuyenDi);
            $('#FileDanhSachPhanXeVaGV').text(registration.FileDanhSachPhanXeVaGV);
            $('#FileHDKKPhoiHopToChuc').text(registration.FileHDKKPhoiHopToChuc);
            $('#FileKeHoachToChuc').text(registration.FileKeHoachToChuc);
            $('#FileLichTrinhHoatDong').text(registration.FileLichTrinhHoatDong);
            $('#FileNoiQuyChuyenDi').text(registration.FileNoiQuyChuyenDi);
            $('#FilePhuongAnChiTietAnToan').text(registration.FilePhuongAnChiTietAnToan);
            $('#FileQDThanhLapBanToChuc').text(registration.FileQDThanhLapBanToChuc);
            $('#FileThuBaoChoChaMe').text(registration.FileThuBaoChoChaMe);
            $('#teacherName').text(registration.Creator);
            $('#jobTitle').text(registration.Jobtitle.Name);
            $('#phoneNumber').text(registration.PhoneNumber);
            $('#email').text(registration.Email);
            
        })
    }
    function closeModal() {
        $('#modal').modal('toggle');
    }
    function getDateDetail() {
        var dateFrom = moment($('#dateFrom').val(), 'DD-MM-YYYY').format('YYYY-MM-DD');
        var dateTo = moment($('#dateTo').val(), 'DD-MM-YYYY').format('YYYY-MM-DD');
        window.location.replace('/quanly/noidungkhac/' + dateFrom + '/' + dateTo);
    }
    function downloadPDF(data) {
        var fileName = data.text.split('.').shift();
            window.location.href = '@System.Configuration.ConfigurationManager.AppSettings["BASE_URL"]/quanly/downloadPDF/' + fileName;
    }
    function downloadExcel() {
        window.location.href = '@System.Configuration.ConfigurationManager.AppSettings["BASE_URL"]/quanly/xuatexcelnoidungkhac/' + moment($('#dateFrom').val(), 'DD-MM-YYYY').format('YYYY-MM-DD') + '/' + moment($('#dateTo').val(), 'DD-MM-YYYY').format('YYYY-MM-DD');

        }
</script>